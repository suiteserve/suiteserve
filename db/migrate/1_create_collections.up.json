[
  {
    "create": "attachments"
  },
  {
    "createIndexes": "attachments",
    "indexes": [
      {
        "key": {
          "suite_id": 1,
          "case_id": 1,
          "timestamp": -1,
          "_id": -1
        },
        "name": "all",
        "partialFilterExpression": {
          "deleted": false
        }
      }
    ]
  },
  {
    "create": "suites"
  },
  {
    "createIndexes": "suites",
    "indexes": [
      {
        "key": {
          "started_at": -1,
          "_id": -1
        },
        "name": "latest",
        "partialFilterExpression": {
          "deleted": false
        }
      },
      {
        "key": {
          "status": 1
        },
        "name": "present",
        "partialFilterExpression": {
          "deleted": false
        }
      }
    ]
  },
  {
    "create": "suites_agg",
    "viewOn": "suites",
    "pipeline": [
      {
        "$match": {
          "deleted": false
        }
      },
      {
        "$facet": {
          "total": [
            {
              "$count": "count"
            }
          ],
          "started": [
            {
              "$match": {
                "status": "started"
              }
            },
            {
              "$count": "count"
            }
          ]
        }
      },
      {
        "$set": {
          "total": {
            "$arrayElemAt": [
              "$total.count",
              0
            ]
          },
          "started": {
            "$arrayElemAt": [
              "$started.count",
              0
            ]
          }
        }
      }
    ]
  },
  {
    "create": "cases"
  },
  {
    "create": "logs"
  }
]
